#!/bin/bash
set -e

# Box64 Optimizations for ARM64 (Ampere Altra optimized)
export BOX64_DYNAREC=1
export BOX64_DYNAREC_STRONGMEM=1
export BOX64_DYNAREC_BIGBLOCK=1
export BOX64_DYNAREC_FORWARD=1024
export BOX64_DYNAREC_CALLRET=1
export BOX64_DYNAREC_SAFEFLAGS=1
export BOX64_DYNAREC_FASTNAN=1
export BOX64_DYNAREC_FASTROUND=1

# Wine Configuration
export WINEDEBUG=-all
export WINEPREFIX="/data/wine-prefix"

# Ensure we have a display for Unity (headless)
export DISPLAY=:99

echo "--> Starting V Rising Server with Box64..."
echo "    Box64 Dynarec Active: YES"
echo "    Wine Prefix: $WINEPREFIX"

# Launch via Box64 -> Wine64 -> Server
# $@ passes all arguments from the entrypoint
exec box64 wine64 "$@"
